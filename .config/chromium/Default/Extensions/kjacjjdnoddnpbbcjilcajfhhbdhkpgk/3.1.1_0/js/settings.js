(function(){"use strict";var bgpage=chrome.extension.getBackgroundPage();var saveBlacklist=function(){var blacklist=[];var bChilds=document.getElementById("blacklist").children;for(var idx in bChilds){var tmpLi=bChilds[idx];if(tmpLi.id!=="new-black"){var childs=tmpLi.children;for(var cidx in childs){if(childs[cidx].nodeName==="SPAN"){blacklist.push(childs[cidx].textContent);break}}}}bgpage.setBlacklist(blacklist);chrome.storage.local.set({blackList:blacklist},function(){})};var addToBlacklist=function(url){var blacklist=document.getElementById("blacklist");var newLi=document.createElement("LI");var x=document.createElement("IMG");x.src="images/settings/delete.png";x.className="x buttons";x.alt="X";newLi.appendChild(x);newLi.appendChild(document.createTextNode(" "));newLi.appendChild(document.createTextNode(" "));var fav=document.createElement("IMG");fav.src="http://"+url+"/favicon.ico";fav.className="favicon";fav.addEventListener("error",function(event){this.src="images/settings/defaultFavicon.png"},false);newLi.appendChild(fav);newLi.appendChild(document.createTextNode(" "));newLi.appendChild(document.createTextNode(" "));var domain=document.createElement("SPAN");domain.textContent=url;newLi.appendChild(domain);blacklist.insertBefore(newLi,document.getElementById("new-black").nextElementSibling)};var addBlacklist=function(event){var t=document.getElementById("new-black-box");var v=t.value.trim();if(v.length>=0){addToBlacklist(v);saveBlacklist()}t.value=""};function initBlacklist(){chrome.storage.local.get({blackList:chrome.extension.getBackgroundPage().getDefaultBlacklist()},function(items){var blacklist=items.blackList;var blacklistElement=document.getElementById("blacklist");var bChilds=blacklistElement.children;while(blacklistElement.lastChild.id!=="new-black"){blacklistElement.removeChild(blacklistElement.lastChild)}for(var idx in blacklist){addToBlacklist(blacklist[blacklist.length-idx-1])}})}function login(){removeClass(document.getElementById("login-loading"),"disappear");addClass(document.getElementById("login-message"),"disappear");var xhr=new XMLHttpRequest;xhr.open("POST","https://c88fef96.forestapp.cc/api/v1/sessions",true);var string=JSON.stringify({email:document.getElementById("login-email-input").value,password:document.getElementById("login-password-input").value});xhr.setRequestHeader("Content-type","application/json; charset=utf-8");xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200){var resp=JSON.parse(xhr.responseText);window.setTimeout(function(){addClass(document.getElementById("login-popup"),"disappear")},300);addClass(document.getElementById("login-popup"),"login-popup-shrink");window.setTimeout(function(){addClass(document.getElementById("login-mask"),"disappear")},300);removeClass(document.getElementById("login-mask"),"login-masked");addClass(document.getElementById("greetingsAnonymous"),"disappear");addClass(document.getElementById("login-message"),"disappear");addClass(document.getElementById("login-loading"),"disappear");removeClass(document.getElementById("greetingsUser"),"disappear");document.getElementById("user-displayname").textContent=resp.user_name;document.getElementById("login-message").textContent="";chrome.storage.local.set({user:resp},function(){});bgpage.updatePurchasedProducts(function(){})}else{removeClass(document.getElementById("login-message"),"disappear");addClass(document.getElementById("login-loading"),"disappear");if(xhr.status==403){setText("login-message",chrome.i18n.getMessage("settings_login_failed"))}else{setText("login-message",chrome.i18n.getMessage("settings_login_failed_error_code")+" "+xhr.status)}}}};xhr.send(string)}window.onload=function(){window.addEventListener("click",function(event){var t=event.target;if(hasClass(t,"x")){var childs=t.parentNode.children;for(var idx in childs){var c=childs[idx];if(c.nodeName==="SPAN"){document.getElementById("blacklist").removeChild(c.parentNode);saveBlacklist();break}}}if(hasClass(t,"os")){var id=t.id;var url="";if(id==="iphone"){url="https://itunes.apple.com/app/forest-stay-focused-stop-phubbing/id866450515?mt=8"}else if(id==="android"){url="https://play.google.com/store/apps/details?id=cc.forestapp"}else if(id==="windows"){url="https://www.microsoft.com/store/apps/9WZDNCRDNLJK"}else{}chrome.tabs.create({url:url},function(tab){});chrome.storage.local.get({user:null},function(items){var user=items.user;ga("send","event","OS-button-clicked","clicked "+id,user!==null?"user":"guest")})}if(t.id=="login-link"){removeClass(document.getElementById("login-popup"),"disappear");window.setTimeout(function(){removeClass(document.getElementById("login-popup"),"login-popup-shrink")},10);removeClass(document.getElementById("login-mask"),"disappear");window.setTimeout(function(){addClass(document.getElementById("login-mask"),"login-masked")},10)}if(t.id=="login-cancel"||t.id=="login-mask"){window.setTimeout(function(){addClass(document.getElementById("login-popup"),"disappear")},300);addClass(document.getElementById("login-popup"),"login-popup-shrink");window.setTimeout(function(){addClass(document.getElementById("login-mask"),"disappear")},300);removeClass(document.getElementById("login-mask"),"login-masked");addClass(document.getElementById("login-message"),"disappear");addClass(document.getElementById("login-loading"),"disappear")}if(t.id=="login-btn"){login()}if(t.id=="settings_sync_tree_species_manually"){addClass(document.getElementById("settings_sync_tree_species_manually_pre"),"disappear");addClass(document.getElementById("settings_sync_tree_species_manually"),"disappear");removeClass(document.getElementById("settings_syncing_tree_species_manually"),"disappear");bgpage.updatePurchasedProducts(function(){window.setTimeout(function(){removeClass(document.getElementById("settings_sync_tree_species_manually_pre"),"disappear");removeClass(document.getElementById("settings_sync_tree_species_manually"),"disappear");addClass(document.getElementById("settings_syncing_tree_species_manually"),"disappear")},1e3)})}if(t.id=="logout-link"){var xhr=new XMLHttpRequest;xhr.open("DELETE","https://c88fef96.forestapp.cc/api/v1/sessions/signout",true);chrome.storage.local.get({user:null},function(items){var user=items.user;var string=JSON.stringify(user);xhr.setRequestHeader("Content-type","application/json; charset=utf-8");xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200){chrome.storage.local.remove("user",function(){});removeClass(document.getElementById("greetingsAnonymous"),"disappear");addClass(document.getElementById("greetingsUser"),"disappear");bgpage.updatePurchasedProducts(function(){})}else{}}};xhr.send(string)})}if(t.id=="settings_no_account_iosapp"){ga("send","event","Dont-have-an-account-link-clicked","clicked iOS app","guest")}if(t.id=="settings_no_account_androidapp"){ga("send","event","Dont-have-an-account-link-clicked","clicked Android App","guest")}},false);window.addEventListener("contextmenu",function(event){event.preventDefault();return false},true);document.getElementById("new-black-box").addEventListener("keypress",function(e){if(!e)e=window.event;var keyCode=e.keyCode||e.which;if(keyCode===13){addBlacklist();document.getElementById("new-black-box").blur()}},false);window.addEventListener("keypress",function(event){if(event.keyCode==13&&(event.target.id=="login-email-input"||event.target.id=="login-password-input")){login();return false}},false);document.getElementById("add-blacklist").addEventListener("click",function(event){removeClass(document.getElementById("new-black"),"new-black-box-hidden");document.getElementById("new-black-box").focus()},false);document.getElementById("new-black-box").addEventListener("blur",function(event){addClass(document.getElementById("new-black"),"new-black-box-hidden");document.getElementById("new-black-box").value=""},false);document.getElementById("forcedMode-enabled").addEventListener("click",function(event){chrome.storage.local.set({forcedMode:document.getElementById("forcedMode-enabled").checked},function(){})},false);initBlacklist();chrome.storage.local.get({user:null},function(items){var user=items.user;if(user!==null){window.setTimeout(function(){addClass(document.getElementById("login-popup"),"disappear")},300);addClass(document.getElementById("login-popup"),"login-popup-shrink");window.setTimeout(function(){addClass(document.getElementById("login-mask"),"disappear")},300);removeClass(document.getElementById("login-mask"),"login-masked");addClass(document.getElementById("greetingsAnonymous"),"disappear");removeClass(document.getElementById("greetingsUser"),"disappear");document.getElementById("user-displayname").textContent=user.user_name;document.getElementById("login-message").textContent=""}});chrome.storage.local.get({forcedMode:true},function(items){document.getElementById("forcedMode-enabled").checked=items.forcedMode});setText("settings_title",chrome.i18n.getMessage("settings_title"));setText("forcedMode-title",chrome.i18n.getMessage("settings_forcedmode_title"));setText("forcedMode-enabled",chrome.i18n.getMessage("settings_forcedmode_enabled"));setText("settings_blacklist_title",chrome.i18n.getMessage("settings_blacklist_title"));document.getElementById("new-black-box").placeholder=chrome.i18n.getMessage("settings_newblackbox_placeholder");setText("settings_connect_title",chrome.i18n.getMessage("settings_connect_title"));setText("login-link",chrome.i18n.getMessage("settings_login_portal"));setText("settings_login_description",chrome.i18n.getMessage("settings_login_description"));setText("settings_no_account1",chrome.i18n.getMessage("settings_no_account1"));setText("settings_no_account_iosapp",chrome.i18n.getMessage("settings_no_account_iosapp"));setText("settings_no_account_or",chrome.i18n.getMessage("settings_no_account_or"));setText("settings_no_account_androidapp",chrome.i18n.getMessage("settings_no_account_androidapp"));setText("settings_no_account2",chrome.i18n.getMessage("settings_no_account2"));setText("settings_other_apps_title",chrome.i18n.getMessage("settings_other_apps_title"));setText("settings_pre_user",chrome.i18n.getMessage("settings_pre_user"));setText("settings_post_user",chrome.i18n.getMessage("settings_post_user"));setText("settings_sync_tree_species_manually_pre",chrome.i18n.getMessage("settings_sync_tree_species_manually_pre"));setText("settings_sync_tree_species_manually",chrome.i18n.getMessage("settings_sync_tree_species_manually"));setText("settings_syncing_tree_species_manually",chrome.i18n.getMessage("settings_syncing_tree_species_manually"));setText("settings_sync_tree_species_manually_post",chrome.i18n.getMessage("settings_sync_tree_species_manually_post"));setText("settings_pre_logout",chrome.i18n.getMessage("settings_pre_logout"));setText("logout-link",chrome.i18n.getMessage("settings_logout"));setText("settings_post_logout",chrome.i18n.getMessage("settings_post_logout"));setText("login-title",chrome.i18n.getMessage("settings_login_title"));setText("login-btn",chrome.i18n.getMessage("settings_login_btn"));setText("login-cancel",chrome.i18n.getMessage("settings_login_cancel"));document.getElementById("login-email-input").placeholder=chrome.i18n.getMessage("settings_login_email");document.getElementById("login-password-input").placeholder=chrome.i18n.getMessage("settings_login_password");setText("settings_other_apps_description",chrome.i18n.getMessage("settings_other_apps_description"));setText("settings_os_iphone",chrome.i18n.getMessage("settings_os_iphone"));setText("settings_os_android",chrome.i18n.getMessage("settings_os_android"));setText("settings_os_windows",chrome.i18n.getMessage("settings_os_windows"))}})();(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date;a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga");ga("create","UA-76810879-1","auto");ga("set","checkProtocolTask",function(){});ga("send","pageview","/settings.html");